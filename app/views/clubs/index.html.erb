<p id="notice"><%= notice %></p>

<h1>Listing Clubs</h1>

<%= form_tag search_path, method: :get do %>
  <div class="field">
    <%= label_tag :big_genre, 'ジャンル' %><br>
    <%= select_tag :big_genre, options_for_select([["未選択", ""], "スポーツ", "エンタメ", "その他"], params[:big_genre]) %>
  </div>
  <div class="field">
    <%= label_tag :small_genre, 'カテゴリ' %><br>
    <%= select_tag :small_genre, options_for_select(get_small_genre_by(params[:big_genre] || ""), params[:small_genre]) %>
  </div>
  <div class="field">
    <%= label_tag 'frequency[]', "活動頻度(1週間あたり)" %><br>
    <%= check_box_tag 'frequency[]', 1, params[:frequency]&.include?('1') %>1
    <%= check_box_tag 'frequency[]', 2, params[:frequency]&.include?('2')  %>2
    <%= check_box_tag 'frequency[]', 3, params[:frequency]&.include?('3')  %>3
    <%= check_box_tag 'frequency[]', 4, params[:frequency]&.include?('4')  %>4
    <%= check_box_tag 'frequency[]', 5, params[:frequency]&.include?('5')  %>5
    <%= check_box_tag 'frequency[]', 6, params[:frequency]&.include?('6')  %>6
    <%= check_box_tag 'frequency[]', 7, params[:frequency]&.include?('7')  %>7
  </div>
  <div class="field">
    <%= label_tag :place, '活動場所' %><br>
    <%= text_field_tag :place, params[:place] %>
  </div>
  <div class="field">
    <%= label_tag 'face[]', 'イケメン率' %><br>
    <%= check_box_tag 'face[]', '高', params[:face]&.include?('高') %>高
    <%= check_box_tag 'face[]', '中', params[:face]&.include?('中') %>中
    <%= check_box_tag 'face[]', '低', params[:face]&.include?('低') %>低
  </div>
  <div class="field">
    <%= label_tag 'drink[]', '飲みサー度' %><br>
    <%= check_box_tag 'drink[]', '高', params[:drink]&.include?('高') %>高
    <%= check_box_tag 'drink[]', '中', params[:drink]&.include?('中') %>中
    <%= check_box_tag 'drink[]', '低', params[:drink]&.include?('低') %>低
  </div>
  <div class="field">
    <%= label_tag 'people[]', '人数規模(1学年あたり)' %><br>
    <%= check_box_tag 'people[]', '30~', params[:people]&.include?('30~') %>30~
    <%= check_box_tag 'people[]', '10~29', params[:people]&.include?('10~29') %>10~29
    <%= check_box_tag 'people[]', '1~9', params[:people]&.include?('1~9') %>1~9
  </div>
  <div class="actions">
    <%= submit_tag "検索" %>
  </div>
<% end %>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Big genre</th>
      <th>Small genre</th>
      <th>Frequency</th>
      <th>Place</th>
      <th>Pr</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @clubs.each do |club| %>
      <tr>
        <td><%= club.name %></td>
        <td><%= club.big_genre %></td>
        <td><%= club.small_genre %></td>
        <td><%= club.frequency %></td>
        <td><%= club.place %></td>
        <td><%= club.pr %></td>
        <td><%= link_to '詳細', club %></td>

      </tr>
    <% end %>
  </tbody>
</table>

<br>

<% if club_signed_in? %>
  <%= link_to 'ログアウト', destroy_club_session_path, method: :delete %>
<% else %>
  <%= link_to 'ログイン', new_club_session_path %>
<% end %>

<script type="text/javascript">
  $(function() {
    $('#big_genre').change(function() {
      $.get({
        url: "/get_small_genre_search",
        data: { big_genre: $('#big_genre').has('option:selected').val() }
      });
    });
  });
</script>
